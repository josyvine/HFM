<!DOCTYPE html>
<html lang="en" style="height: 100%;">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Storage Treemap</title>
<style>
        html, body { height: 100%; width: 100%; margin: 0; padding: 0; overflow: hidden; background-color: #111; }
        #main { height: 100%; width: 100%; }
</style>
  </head>
  <body style="height: 100%; margin: 0;">

    <div id="main" style="height: 100%;"></div>

    <script src="file:///android_asset/echarts.min.js"></script>

<script type="text/javascript">
        var myChart = echarts.init(document.getElementById('main'));

        var Android = {
            onFileClicked: function(fileDetailsJson) {
                if (window.HFM_AndroidInterface && typeof window.HFM_AndroidInterface.onFileClicked === 'function') {
                    window.HFM_AndroidInterface.onFileClicked(fileDetailsJson);
                } else {
                    console.log("Android interface not found. Details: " + fileDetailsJson);
                }
            }
        };

        // This function will be called by the Java code after the page finishes loading.
        function initializeTreemap() {
            if (window.HFM_AndroidInterface && typeof window.HFM_AndroidInterface.getJsonData === 'function') {
                // Safely "pull" the data from the Java interface
                var jsonData = window.HFM_AndroidInterface.getJsonData();
                if (jsonData) {
                    loadTreemapData(jsonData);
                } else {
                    console.log("Failed to get JSON data from Android.");
                }
            } else {
                console.log("Android interface or getJsonData function not found.");
            }
        }

        function loadTreemapData(jsonData) {
            var data = JSON.parse(jsonData);

            var option = {
                tooltip: {
                    formatter: function (info) {
                        var value = info.value;
                        var sizeInBytes = value;
                        var sizeText = '';
                        if (sizeInBytes < 1024) { sizeText = sizeInBytes + ' B'; }
                        else if (sizeInBytes < 1024 * 1024) { sizeText = (sizeInBytes / 1024).toFixed(2) + ' KB'; }
                        else if (sizeInBytes < 1024 * 1024 * 1024) { sizeText = (sizeInBytes / (1024 * 1024)).toFixed(2) + ' MB'; }
                        else { sizeText = (sizeInBytes / (1024 * 1024 * 1024)).toFixed(2) + ' GB'; }
                        return echarts.format.encodeHTML(info.name) + '<br/>Size: ' + sizeText;
                    }
                },
                series: [{
                    name: 'Storage',
                    type: 'treemap',
                    // MODIFICATION: Set roam to true to enable both panning/dragging and zooming.
                    roam: true,
                    label: { show: true, formatter: '{b}', color: '#fff' },
                    upperLabel: { show: true, height: 20, color: '#fff' },
                    itemStyle: { borderColor: '#333', borderWidth: 1, gapWidth: 1 },
                    breadcrumb: { height: 20, itemStyle: { textStyle: { color: '#fff' } } },
                    data: [data]
                }]
            };
            myChart.setOption(option);
        }

        myChart.on('click', function(params) {
            var clickedNode = params.data;
            if (clickedNode && !clickedNode.children) {
                Android.onFileClicked(JSON.stringify(clickedNode));
            }
        });
</script>
  </body>
</html>

